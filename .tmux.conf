# --- 核心设置 (Core Settings) ---
# 前缀键改为 C-x (Emacs Style)
unbind C-b
set -g prefix C-x
bind C-x send-prefix

# --- Emacs 兼容模式 ---
# 连按两次 C-x 将前缀发送给内部应用 (Emacs)
# 这样:
#   C-x 2 -> Tmux 分屏
#   C-x C-x s -> Emacs 保存文件
#   C-x C-x C-f -> Emacs 打开文件
bind C-x send-prefix


# 基础索引从1开始，方便手指触摸
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on

# 鼠标支持 (调整大小时很有用)
set -g mouse on

# 减少 ESC 延迟 (对 Vim/Emacs 用户很重要)
set -sg escape-time 10

# 增加历史记录
set -g history-limit 50000

# 256色与真彩支持
set -g default-terminal "xterm-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# --- 按键绑定 (Keybindings) ---
# 重载配置: Prefix + r
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# 分屏 (保留当前路径)
bind 2 split-window -v -c "#{pane_current_path}" # Emacs C-x 2
bind 3 split-window -h -c "#{pane_current_path}" # Emacs C-x 3
unbind '"'
unbind %

# 创建新窗口 (保留当前路径)
bind c new-window -c "#{pane_current_path}"

# 面板导航 (Emacs Style: C-n/p/f/b)
# 需要配合 Prefix 键使用，例如 C-x C-n
bind C-n select-pane -D
bind C-p select-pane -U
bind C-f select-pane -R
bind C-b select-pane -L

# 窗口切换
bind -n M-p previous-window
bind -n M-n next-window

# 复制模式 (Emacs Style)
setw -g mode-keys emacs
bind -T copy-mode y send-keys -X copy-pipe-and-cancel "wl-copy" # Wayland 剪贴板

# --- 插件管理 (Plugins) ---
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect' # 保存会话
set -g @plugin 'tmux-plugins/tmux-continuum' # 自动保存
set -g @plugin 'egel/tmux-gruvbox'          # Gruvbox 主题

# --- 插件配置 ---
# Gruvbox 主题设置
set -g @tmux-gruvbox 'dark' # or 'light'

# --- 弹窗功能 (Popups) ---
# 居中弹出临时终端
bind C-z display-popup -E -w 80% -h 80%

# 弹出临时终端并打开当前目录
bind t display-popup -E -w 80% -h 80% -d "#{pane_current_path}"

# 弹出任务管理器 (htop)
bind h display-popup -E -w 80% -h 80% "btop"

# 自动恢复/保存配置
set -g @continuum-restore 'on'

# 初始化 TPM (必须放在最后)
run '~/.tmux/plugins/tpm/tpm'
